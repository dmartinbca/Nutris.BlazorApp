@page "/customer-profile"
@using NutrisBlazor.Services
@inject IAuthService AuthService
@inject ILocalStorageService LocalStorage
@inject NavigationManager Navigation
@inject ILocalizationService Localization

<link href="/css/CustomerProfile.css" rel="stylesheet" />
<link href="/css/fonts.css" rel="stylesheet" />

@if (IsLoading)
{
    <div class="loading-overlay">
        <div class="spinner"></div>
    </div>
}

<!-- Fondo similar al login -->
<div class="customer-profile-fondo">

    <!-- Language Selector -->
    <div class="language-selector-customer">
        <button class="language-button" type="button" @onclick="@ToggleLanguageMenu">
            @if (currentLanguage == "es")
            {
                <span>Español</span>
            }
            else
            {
                <span>English</span>
            }
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z" />
            </svg>
        </button>

        @if (showLanguageMenu)
        {
            <div class="language-dropdown">
                <button class="dropdown-item" type="button" @onclick="@(() => SelectLanguage("en"))">
                    English
                </button>
                <button class="dropdown-item" type="button" @onclick="@(() => SelectLanguage("es"))">
                    Español
                </button>
            </div>
        }
    </div>

    <!-- Container centrado -->
    <div class="customer-profile-container">
        <div class="profile-card shadow-sm">
            <div class="profile-card-body">

                <!-- Back Button -->
                <div class="mb-3">
                    <button @onclick="GoBack" class="profile-back-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
                        </svg>
                    </button>
                </div>

                <!-- Header con logo y nombre -->
                <div class="profile-header-section">
                    <div class="logo-wrapper">
                        @if (!string.IsNullOrEmpty(CustomerData?.Logo))
                        {
                            <img src="data:image/png;base64,@CustomerData.Logo" alt="@CustomerData.Name" class="company-logo" />
                        }
                        else
                        {
                            <div class="logo-placeholder">
                                <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" />
                                </svg>
                            </div>
                        }
                    </div>
                    <div class="header-text">
                        <h2 class="company-name RalewayBold">@CustomerData?.Name</h2>
                        <p class="customer-code RalewayRegular">@Localization["customerProfile.Code"]: @CustomerData?.Customer</p>
                    </div>
                </div>

                <!-- Información en secciones compactas -->
                <div class="profile-sections">

                    <!-- Información de Empresa -->
                    <div class="profile-section">
                        <h3 class="section-title RalewayBold">@Localization["customerProfile.CompanyInfo"]</h3>
                        <div class="section-content">
                            <div class="info-item">
                                <span class="info-label">@Localization["customerProfile.VAT"]:</span>
                                <span class="info-value">@(CustomerData?.CIF ?? "-")</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">@Localization["customerProfile.Contact"]:</span>
                                <span class="info-value">@(CustomerData?.Contact ?? "-")</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">@Localization["customerProfile.ShipmentMethod"]:</span>
                                <span class="info-value">@(CustomerData?.Shipment_Method_Code ?? "-")</span>
                            </div>
                        </div>
                    </div>

                    <!-- Dirección -->
                    <div class="profile-section">
                        <h3 class="section-title RalewayBold">@Localization["customerProfile.Address"]</h3>
                        <div class="section-content">
                            <div class="info-item">
                                <span class="info-label">@Localization["customerProfile.Address1"]:</span>
                                <span class="info-value">@(CustomerData?.Address ?? "-")</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">@Localization["customerProfile.City"]:</span>
                                <span class="info-value">@(CustomerData?.City ?? "-")</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">@Localization["customerProfile.County"]:</span>
                                <span class="info-value">@(CustomerData?.County ?? "-")</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">@Localization["customerProfile.PostCode"]:</span>
                                <span class="info-value">@(CustomerData?.Post_Code ?? "-")</span>
                            </div>
                        </div>
                    </div>

                    <!-- Contacto -->
                    <div class="profile-section">
                        <h3 class="section-title RalewayBold">@Localization["customerProfile.ContactInfo"]</h3>
                        <div class="section-content">
                            <div class="info-item">
                                <span class="info-label">@Localization["customerProfile.Email"]:</span>
                                <span class="info-value email-value">
                                    @if (!string.IsNullOrEmpty(CustomerData?.Email))
                                    {
                                        <a href="mailto:@CustomerData.Email">@CustomerData.Email</a>
                                    }
                                    else
                                    {
                                        <span>-</span>
                                    }
                                </span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">@Localization["customerProfile.Phone"]:</span>
                                <span class="info-value">@(CustomerData?.Phone ?? "-")</span>
                            </div>
                        </div>
                    </div>

                    <!-- Equipo Comercial -->
                    <div class="profile-section">
                        <h3 class="section-title RalewayBold">@Localization["customerProfile.SalesTeam"]</h3>
                        <div class="section-content">
                            <div class="info-item">
                                <span class="info-label">@Localization["customerProfile.SalesRep"]:</span>
                                <span class="info-value">@(CustomerData?.Nombre_Vendedor ?? "-")</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">@Localization["customerProfile.SalesSupport"]:</span>
                                <span class="info-value">@(CustomerData?.Sales_Support ?? "-")</span>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private bool IsLoading = false;
    private bool showLanguageMenu = false;
    private string currentLanguage = "es";
    private NutrisBlazor.Services.User CustomerData;

    protected override async Task OnInitializedAsync()
    {
        IsLoading = true;
        currentLanguage = Localization.CurrentLanguage ?? "es";

        try
        {
            CustomerData = await AuthService.GetCurrentUserAsync();

            if (CustomerData == null)
            {
                Navigation.NavigateTo("/");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading customer data: {ex.Message}");
        }
        finally
        {
            IsLoading = false;
        }
    }

    private void ToggleLanguageMenu()
    {
        showLanguageMenu = !showLanguageMenu;
    }

    private async Task SelectLanguage(string language)
    {
        showLanguageMenu = false;
        currentLanguage = language;
        await Localization.ChangeLanguageAsync(language);
        StateHasChanged();
    }

    private void GoBack()
    {
        Navigation.NavigateTo("/home");
    }
}